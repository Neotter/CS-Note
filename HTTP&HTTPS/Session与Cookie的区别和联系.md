<!--
 * @Author: Nettor
 * @Date: 2020-06-17 13:18:15
 * @LastEditors: Nettor
 * @LastEditTime: 2020-06-17 16:39:29
 * @Description: file content
-->

# Session 的存储方式

## 1.Session 在服务器端

Session 是存放在服务器端的，Session 就像一个小的数据库，来存放用户数据，当浏览器 第一次发送请求时，服务器自动生成了一个 Session 和一个 Session ID 用来唯一标识这个 Session，并将其通过响应发送到浏览器。当浏览器第二次发送请求，会将前一次服务器响应中的 Session ID 放在请求中一并发送到服务器上，服务器从请求中提取出 Session ID，并和保存的所有 Session ID 进行对比，找到这个用户对应的 Session。

一般情况下，服务器会在一定时间内（默认 30 分钟）保存这个 Session，过了时间限制，就会销毁这个 Session。在 Session 没有被销毁的情况下，程序员可以将用户的一些数据以 Key 和 Value 的形式暂时存放在这个 Session 中。当然，也有使用数据库将这个 Session 序列化后保存起来的，这样的好处是没了时间的限制，坏处是随着时间的增加，这个数据 库会急速膨胀，特别是访问量增加的时候。一般还是采取前一种方式，以减轻服务器压力。

## 2. Session 在客户端

一般浏览器提供了两种方式来保存 Session，还有一种是程序员使用 html 隐藏域的方式自定义实现：

①. 使用 Cookie 来保存，这是最常见的方法，“记住我的登录状态”功能的实现正是基于这种方式的。服务器通过设置 Cookie 的方式将 SessionID 发送到浏览器。如果我们不设置这个过期时间，那么这个 Cookie 将不存放在硬盘上，当浏览器关闭的时候，Cookie 就消失了，这个 SessionID 就丢失了。如果我们设置这个时间为若干天之后，那么这个 Cookie 会保存在客户端硬盘中，即使浏览器关闭，这个值仍然存在，下次访问相应网站时，同样会发送到服务器上。

②. 使用 URL 附加信息的方式，也就是像我们经常看到 JSP 网站会有 aaa.jsp?JSESSIONID=\*一样的。这种方式和第一种方式里面不设置 Cookie 过期时间是一样的。

③. 第三种方式是在页面表单里面增加隐藏域，这种方式实际上和第二种方式一样，只不过前者通过 GET 方式发送数据，后者使用 POST 方式发送数据。但是明显后者比较麻烦。

## 3. cookie 与 session 的优缺点

### Cookies 数据保存在客户端，session 数据保存在服务器端

Cookies 是属于 Session 对象的一种。Cookies 不会占服务器资源，是存在客服端内存或者一个 Cookies 的文本文件中；而“Session”则会占用服务器资源。

当登录一个网站的时候，如果 web 服务器端使用的是 session,那么所有的数据都保存在服务器上面，客户端每次请求服务器的时候会发送当前会话的 SessionID 判断相应的用户数据标志，以确定用户是否登录，或具有某种权限。由于数据是存储在服务器上面，所以很难伪造，但是如果能够获取某个登录用户的 SessionID，用特殊的浏览器伪造该用户的请求也是能够成功的。SessionID 是服务器和客户端链接时候随机分配的，一般来说是不会有重复，但如果有大量的并发请求，也是有重复的可能性。

如果浏览器使用的是 Cookies，那么所有的数据都保存在浏览器端。
比如登录以后，服务器设置了 Cookies 用户名(username),那么，当你再次请求服务器的时候，浏览器会将 username 一块发送给服务器。

### Cookies 不可靠，Session 相对可靠

理论上来说如果能够截获某个用户的 Cookies 变量，然后伪造一个数据包发送过去，那么服务器还是认为你是合法的。所以，使用 Cookies 被攻击的可能性比较大。

## 4. Cookies 被禁用时怎么用 Session

Session 是由应用服务器维持的一个服务器端的存储空间，用户在连接服务器时，会由服务器生成一个唯一的 SessionID,用该 SessionID 为标识符来存取服务器端的 Session 存储空间。而 SessionID 这一数据则是保存到客户端，用 Cookie 保存的，用户提交页面时，会将这一 SessionID 提交到服务器端，来存取 Session 数据。**所以一般来说一旦客户端禁用 Cookie，那么 Session 也会失效。**

但服务器也可以通过 URL 重写的方式来传递 SessionID 的值，因此不是完全依赖 Cookie。如果客户端 Cookie 禁用，则服务器可以自动通过重写 URL 的方式来保存 Session 的值，即，把 SessionID 用`.com?SessionID=\`这种方式传递给浏览器。

## 5. 什么信息存在 Session，什么信息存在 Cookies

用户的各种私人信息，比如姓名等，一般情况下，保存在 Session 里。
需要在页面间传递的内容信息，比如调查工作需要分好几步。每一步的信息都保存在 Session 里，最后在统一更新到数据库。

如果真的需要用 Cookies 存储需要注意一下几点：

- 任何重要数据，最好通过加密形式来保存数据（最简单的可以用 URLEncode，当然也可以用完善的可逆加密方式，遗憾的是，最好不要用 md5 来加密）。
- 是否保存登陆信息，需有用户自行选择。
- 长于 10K 的数据，不要用到 Cookies。

## 5.Cookie 最典型的应用

- 判断用户是否登陆过网站，以便下次登录时能够直接登录。如果我们删除 cookie，则每次登录必须从新填写登录的相关信息。

- 另一个重要的应用是“购物车”中类的处理和设计。用户可能在一段时间内在同一家网站的不同页面选择不同的商品，可以将这些信息都写入 cookie，在最后付款时从 cookie 中提取这些信息，当然这里面有了安全和性能问题需要我们考虑了。
